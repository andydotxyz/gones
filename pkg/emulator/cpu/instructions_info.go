package cpu

type InstructionInfo struct {
	OpCode         byte
	Nemonics       string
	AddressingMode AddressingMode
	Cycles         int
	VariableCycles bool
}

var InstructionInfos = [256]InstructionInfo{
	0x00: {0x00, "BRK", IMP, 7, false},
	0x01: {0x01, "ORA", IZX, 6, false},
	0x02: {0x02, "KIL", IMP, 0, false},
	0x03: {0x03, "SLO", IZX, 8, false},
	0x04: {0x04, "NOP", ZP, 3, false},
	0x05: {0x05, "ORA", ZP, 3, false},
	0x06: {0x06, "ASL", ZP, 5, false},
	0x07: {0x07, "SLO", ZP, 5, false},
	0x08: {0x08, "PHP", IMP, 3, false},
	0x09: {0x09, "ORA", IMM, 2, false},
	0x0a: {0x0a, "ASL", IMP, 2, false},
	0x0b: {0x0b, "ANC", IMM, 2, false},
	0x0c: {0x0c, "NOP", ABS, 4, false},
	0x0d: {0x0d, "ORA", ABS, 4, false},
	0x0e: {0x0e, "ASL", ABS, 6, false},
	0x0f: {0x0f, "SLO", ABS, 6, false},
	0x10: {0x10, "BPL", REL, 2, true},
	0x11: {0x11, "ORA", IZY, 5, true},
	0x12: {0x12, "KIL", IMP, 0, false},
	0x13: {0x13, "SLO", IZY, 8, false},
	0x14: {0x14, "NOP", ZPX, 4, false},
	0x15: {0x15, "ORA", ZPX, 4, false},
	0x16: {0x16, "ASL", ZPX, 6, false},
	0x17: {0x17, "SLO", ZPX, 6, false},
	0x18: {0x18, "CLC", IMP, 2, false},
	0x19: {0x19, "ORA", ABY, 4, true},
	0x1a: {0x1a, "NOP", IMP, 2, false},
	0x1b: {0x1b, "SLO", ABY, 7, false},
	0x1c: {0x1c, "NOP", ABX, 4, true},
	0x1d: {0x1d, "ORA", ABX, 4, true},
	0x1e: {0x1e, "ASL", ABX, 7, false},
	0x1f: {0x1f, "SLO", ABX, 7, false},
	0x20: {0x20, "JSR", ABS, 6, false},
	0x21: {0x21, "AND", IZX, 6, false},
	0x22: {0x22, "KIL", IMP, 0, false},
	0x23: {0x23, "RLA", IZX, 8, false},
	0x24: {0x24, "BIT", ZP, 3, false},
	0x25: {0x25, "AND", ZP, 3, false},
	0x26: {0x26, "ROL", ZP, 5, false},
	0x27: {0x27, "RLA", ZP, 5, false},
	0x28: {0x28, "PLP", IMP, 4, false},
	0x29: {0x29, "AND", IMM, 2, false},
	0x2a: {0x2a, "ROL", IMP, 2, false},
	0x2b: {0x2b, "ANC", IMM, 2, false},
	0x2c: {0x2c, "BIT", ABS, 4, false},
	0x2d: {0x2d, "AND", ABS, 4, false},
	0x2e: {0x2e, "ROL", ABS, 6, false},
	0x2f: {0x2f, "RLA", ABS, 6, false},
	0x30: {0x30, "BMI", REL, 2, true},
	0x31: {0x31, "AND", IZY, 5, true},
	0x32: {0x32, "KIL", IMP, 0, false},
	0x33: {0x33, "RLA", IZY, 8, false},
	0x34: {0x34, "NOP", ZPX, 4, false},
	0x35: {0x35, "AND", ZPX, 4, false},
	0x36: {0x36, "ROL", ZPX, 6, false},
	0x37: {0x37, "RLA", ZPX, 6, false},
	0x38: {0x38, "SEC", IMP, 2, false},
	0x39: {0x39, "AND", ABY, 4, true},
	0x3a: {0x3a, "NOP", IMP, 2, false},
	0x3b: {0x3b, "RLA", ABY, 7, false},
	0x3c: {0x3c, "NOP", ABX, 4, true},
	0x3d: {0x3d, "AND", ABX, 4, true},
	0x3e: {0x3e, "ROL", ABX, 7, false},
	0x3f: {0x3f, "RLA", ABX, 7, false},
	0x40: {0x40, "RTI", IMP, 6, false},
	0x41: {0x41, "EOR", IZX, 6, false},
	0x42: {0x42, "KIL", IMP, 0, false},
	0x43: {0x43, "SRE", IZX, 8, false},
	0x44: {0x44, "NOP", ZP, 3, false},
	0x45: {0x45, "EOR", ZP, 3, false},
	0x46: {0x46, "LSR", ZP, 5, false},
	0x47: {0x47, "SRE", ZP, 5, false},
	0x48: {0x48, "PHA", IMP, 3, false},
	0x49: {0x49, "EOR", IMM, 2, false},
	0x4a: {0x4a, "LSR", IMP, 2, false},
	0x4b: {0x4b, "ALR", IMM, 2, false},
	0x4c: {0x4c, "JMP", ABS, 3, false},
	0x4d: {0x4d, "EOR", ABS, 4, false},
	0x4e: {0x4e, "LSR", ABS, 6, false},
	0x4f: {0x4f, "SRE", ABS, 6, false},
	0x50: {0x50, "BVC", REL, 2, true},
	0x51: {0x51, "EOR", IZY, 5, true},
	0x52: {0x52, "KIL", IMP, 0, false},
	0x53: {0x53, "SRE", IZY, 8, false},
	0x54: {0x54, "NOP", ZPX, 4, false},
	0x55: {0x55, "EOR", ZPX, 4, false},
	0x56: {0x56, "LSR", ZPX, 6, false},
	0x57: {0x57, "SRE", ZPX, 6, false},
	0x58: {0x58, "CLI", IMP, 2, false},
	0x59: {0x59, "EOR", ABY, 4, true},
	0x5a: {0x5a, "NOP", IMP, 2, false},
	0x5b: {0x5b, "SRE", ABY, 7, false},
	0x5c: {0x5c, "NOP", ABX, 4, true},
	0x5d: {0x5d, "EOR", ABX, 4, true},
	0x5e: {0x5e, "LSR", ABX, 7, false},
	0x5f: {0x5f, "SRE", ABX, 7, false},
	0x60: {0x60, "RTS", IMP, 6, false},
	0x61: {0x61, "ADC", IZX, 6, false},
	0x62: {0x62, "KIL", IMP, 0, false},
	0x63: {0x63, "RRA", IZX, 8, false},
	0x64: {0x64, "NOP", ZP, 3, false},
	0x65: {0x65, "ADC", ZP, 3, false},
	0x66: {0x66, "ROR", ZP, 5, false},
	0x67: {0x67, "RRA", ZP, 5, false},
	0x68: {0x68, "PLA", IMP, 4, false},
	0x69: {0x69, "ADC", IMM, 2, false},
	0x6a: {0x6a, "ROR", IMP, 2, false},
	0x6b: {0x6b, "ARR", IMM, 2, false},
	0x6c: {0x6c, "JMP", IND, 5, false},
	0x6d: {0x6d, "ADC", ABS, 4, false},
	0x6e: {0x6e, "ROR", ABS, 6, false},
	0x6f: {0x6f, "RRA", ABS, 6, false},
	0x70: {0x70, "BVS", REL, 2, true},
	0x71: {0x71, "ADC", IZY, 5, true},
	0x72: {0x72, "KIL", IMP, 0, false},
	0x73: {0x73, "RRA", IZY, 8, false},
	0x74: {0x74, "NOP", ZPX, 4, false},
	0x75: {0x75, "ADC", ZPX, 4, false},
	0x76: {0x76, "ROR", ZPX, 6, false},
	0x77: {0x77, "RRA", ZPX, 6, false},
	0x78: {0x78, "SEI", IMP, 2, false},
	0x79: {0x79, "ADC", ABY, 4, true},
	0x7a: {0x7a, "NOP", IMP, 2, false},
	0x7b: {0x7b, "RRA", ABY, 7, false},
	0x7c: {0x7c, "NOP", ABX, 4, true},
	0x7d: {0x7d, "ADC", ABX, 4, true},
	0x7e: {0x7e, "ROR", ABX, 7, false},
	0x7f: {0x7f, "RRA", ABX, 7, false},
	0x80: {0x80, "NOP", IMM, 2, false},
	0x81: {0x81, "STA", IZX, 6, false},
	0x82: {0x82, "NOP", IMM, 2, false},
	0x83: {0x83, "SAX", IZX, 6, false},
	0x84: {0x84, "STY", ZP, 3, false},
	0x85: {0x85, "STA", ZP, 3, false},
	0x86: {0x86, "STX", ZP, 3, false},
	0x87: {0x87, "SAX", ZP, 3, false},
	0x88: {0x88, "DEY", IMP, 2, false},
	0x89: {0x89, "NOP", IMM, 2, false},
	0x8a: {0x8a, "TXA", IMP, 2, false},
	0x8b: {0x8b, "XAA", IMM, 2, false},
	0x8c: {0x8c, "STY", ABS, 4, false},
	0x8d: {0x8d, "STA", ABS, 4, false},
	0x8e: {0x8e, "STX", ABS, 4, false},
	0x8f: {0x8f, "SAX", ABS, 4, false},
	0x90: {0x90, "BCC", REL, 2, true},
	0x91: {0x91, "STA", IZY, 6, false},
	0x92: {0x92, "KIL", IMP, 0, false},
	0x93: {0x93, "AHX", IZY, 6, false},
	0x94: {0x94, "STY", ZPX, 4, false},
	0x95: {0x95, "STA", ZPX, 4, false},
	0x96: {0x96, "STX", ZPY, 4, false},
	0x97: {0x97, "SAX", ZPY, 4, false},
	0x98: {0x98, "TYA", IMP, 2, false},
	0x99: {0x99, "STA", ABY, 5, false},
	0x9a: {0x9a, "TXS", IMP, 2, false},
	0x9b: {0x9b, "TAS", ABY, 5, false},
	0x9c: {0x9c, "SHY", ABX, 5, false},
	0x9d: {0x9d, "STA", ABX, 5, false},
	0x9e: {0x9e, "SHX", ABY, 5, false},
	0x9f: {0x9f, "AHX", ABY, 5, false},
	0xa0: {0xa0, "LDY", IMM, 2, false},
	0xa1: {0xa1, "LDA", IZX, 6, false},
	0xa2: {0xa2, "LDX", IMM, 2, false},
	0xa3: {0xa3, "LAX", IZX, 6, false},
	0xa4: {0xa4, "LDY", ZP, 3, false},
	0xa5: {0xa5, "LDA", ZP, 3, false},
	0xa6: {0xa6, "LDX", ZP, 3, false},
	0xa7: {0xa7, "LAX", ZP, 3, false},
	0xa8: {0xa8, "TAY", IMP, 2, false},
	0xa9: {0xa9, "LDA", IMM, 2, false},
	0xaa: {0xaa, "TAX", IMP, 2, false},
	0xab: {0xab, "LAX", IMM, 2, false},
	0xac: {0xac, "LDY", ABS, 4, false},
	0xad: {0xad, "LDA", ABS, 4, false},
	0xae: {0xae, "LDX", ABS, 4, false},
	0xaf: {0xaf, "LAX", ABS, 4, false},
	0xb0: {0xb0, "BCS", REL, 2, true},
	0xb1: {0xb1, "LDA", IZY, 5, true},
	0xb2: {0xb2, "KIL", IMP, 0, false},
	0xb3: {0xb3, "LAX", IZY, 5, true},
	0xb4: {0xb4, "LDY", ZPX, 4, false},
	0xb5: {0xb5, "LDA", ZPX, 4, false},
	0xb6: {0xb6, "LDX", ZPY, 4, false},
	0xb7: {0xb7, "LAX", ZPY, 4, false},
	0xb8: {0xb8, "CLV", IMP, 2, false},
	0xb9: {0xb9, "LDA", ABY, 4, true},
	0xba: {0xba, "TSX", IMP, 2, false},
	0xbb: {0xbb, "LAS", ABY, 4, true},
	0xbc: {0xbc, "LDY", ABX, 4, true},
	0xbd: {0xbd, "LDA", ABX, 4, true},
	0xbe: {0xbe, "LDX", ABY, 4, true},
	0xbf: {0xbf, "LAX", ABY, 4, true},
	0xc0: {0xc0, "CPY", IMM, 2, false},
	0xc1: {0xc1, "CMP", IZX, 6, false},
	0xc2: {0xc2, "NOP", IMM, 2, false},
	0xc3: {0xc3, "DCP", IZX, 8, false},
	0xc4: {0xc4, "CPY", ZP, 3, false},
	0xc5: {0xc5, "CMP", ZP, 3, false},
	0xc6: {0xc6, "DEC", ZP, 5, false},
	0xc7: {0xc7, "DCP", ZP, 5, false},
	0xc8: {0xc8, "INY", IMP, 2, false},
	0xc9: {0xc9, "CMP", IMM, 2, false},
	0xca: {0xca, "DEX", IMP, 2, false},
	0xcb: {0xcb, "AXS", IMM, 2, false},
	0xcc: {0xcc, "CPY", ABS, 4, false},
	0xcd: {0xcd, "CMP", ABS, 4, false},
	0xce: {0xce, "DEC", ABS, 6, false},
	0xcf: {0xcf, "DCP", ABS, 6, false},
	0xd0: {0xd0, "BNE", REL, 2, true},
	0xd1: {0xd1, "CMP", IZY, 5, true},
	0xd2: {0xd2, "KIL", IMP, 0, false},
	0xd3: {0xd3, "DCP", IZY, 8, false},
	0xd4: {0xd4, "NOP", ZPX, 4, false},
	0xd5: {0xd5, "CMP", ZPX, 4, false},
	0xd6: {0xd6, "DEC", ZPX, 6, false},
	0xd7: {0xd7, "DCP", ZPX, 6, false},
	0xd8: {0xd8, "CLD", IMP, 2, false},
	0xd9: {0xd9, "CMP", ABY, 4, true},
	0xda: {0xda, "NOP", IMP, 2, false},
	0xdb: {0xdb, "DCP", ABY, 7, false},
	0xdc: {0xdc, "NOP", ABX, 4, true},
	0xdd: {0xdd, "CMP", ABX, 4, true},
	0xde: {0xde, "DEC", ABX, 7, false},
	0xdf: {0xdf, "DCP", ABX, 7, false},
	0xe0: {0xe0, "CPX", IMM, 2, false},
	0xe1: {0xe1, "SBC", IZX, 6, false},
	0xe2: {0xe2, "NOP", IMM, 2, false},
	0xe3: {0xe3, "ISC", IZX, 8, false},
	0xe4: {0xe4, "CPX", ZP, 3, false},
	0xe5: {0xe5, "SBC", ZP, 3, false},
	0xe6: {0xe6, "INC", ZP, 5, false},
	0xe7: {0xe7, "ISC", ZP, 5, false},
	0xe8: {0xe8, "INX", IMP, 2, false},
	0xe9: {0xe9, "SBC", IMM, 2, false},
	0xea: {0xea, "NOP", IMP, 2, false},
	0xeb: {0xeb, "SBC", IMM, 2, false},
	0xec: {0xec, "CPX", ABS, 4, false},
	0xed: {0xed, "SBC", ABS, 4, false},
	0xee: {0xee, "INC", ABS, 6, false},
	0xef: {0xef, "ISC", ABS, 6, false},
	0xf0: {0xf0, "BEQ", REL, 2, true},
	0xf1: {0xf1, "SBC", IZY, 5, true},
	0xf2: {0xf2, "KIL", IMP, 0, false},
	0xf3: {0xf3, "ISC", IZY, 8, false},
	0xf4: {0xf4, "NOP", ZPX, 4, false},
	0xf5: {0xf5, "SBC", ZPX, 4, false},
	0xf6: {0xf6, "INC", ZPX, 6, false},
	0xf7: {0xf7, "ISC", ZPX, 6, false},
	0xf8: {0xf8, "SED", IMP, 2, false},
	0xf9: {0xf9, "SBC", ABY, 4, true},
	0xfa: {0xfa, "NOP", IMP, 2, false},
	0xfb: {0xfb, "ISC", ABY, 7, false},
	0xfc: {0xfc, "NOP", ABX, 4, true},
	0xfd: {0xfd, "SBC", ABX, 4, true},
	0xfe: {0xfe, "INC", ABX, 7, false},
	0xff: {0xff, "ISC", ABX, 7, false},
}

func Decode(opcode byte) (string, AddressingMode) {
	// Most instructions that explicitly reference memory locations have bit patterns of the form aaabbbcc.
	// The aaa and cc bits determine the opcode, and the bbb bits determine the addressing mode.
	//cc := opcode & 0x3
	//bbb := (opcode >> 2) & 0x7
	//aaa := opcode >> 5
	//logger.Printf("opcode=%x, aaa=%x, bbb=%x, cc=%x", opcode, aaa, bbb, cc)
	info := &InstructionInfos[opcode]
	opName := info.Nemonics
	return opName, info.AddressingMode
}
